CREATE TABLE BRAND_TABLE WITH (
  KAFKA_TOPIC = 'BRAND_TABLE',
  PARTITIONS = 1,
  REPLICAS = 1,
  KEY_FORMAT = 'JSON',
  VALUE_FORMAT = 'JSON'
) AS
SELECT
  AFTER->ID AS ID,
  LATEST_BY_OFFSET(AFTER->NAME) AS NAME,
  LATEST_BY_OFFSET(AFTER->SLUG) AS SLUG,
  LATEST_BY_OFFSET(AFTER->DESCRIPTION) AS DESCRIPTION,
  LATEST_BY_OFFSET(AFTER->LOGO_URL) AS LOGO_URL,
  LATEST_BY_OFFSET(AFTER->WEBSITE) AS WEBSITE
FROM BRAND_RAW
WHERE OP != 'd'
GROUP BY AFTER->ID
EMIT CHANGES;


CREATE TABLE SELLER_TABLE WITH (
  KAFKA_TOPIC = 'SELLER_TABLE',
  PARTITIONS = 1,
  REPLICAS = 1,
  KEY_FORMAT = 'JSON',
  VALUE_FORMAT = 'JSON'
) AS
SELECT
  AFTER->ID AS ID,
  LATEST_BY_OFFSET(AFTER->NAME) AS NAME,
  LATEST_BY_OFFSET(AFTER->DESCRIPTION) AS DESCRIPTION,
  LATEST_BY_OFFSET(AFTER->LOGO_URL) AS LOGO_URL,
  LATEST_BY_OFFSET(AFTER->RATING) AS RATING,
  LATEST_BY_OFFSET(AFTER->CONTACT_EMAIL) AS CONTACT_EMAIL,
  LATEST_BY_OFFSET(AFTER->CONTACT_PHONE) AS CONTACT_PHONE,
  LATEST_BY_OFFSET(AFTER->CREATED_AT) AS CREATED_AT
FROM SELLER_RAW
WHERE OP != 'd'
GROUP BY AFTER->ID
EMIT CHANGES;
